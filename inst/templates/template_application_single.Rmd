---
params:
  applicant_id: 1
  anon_path: "data/applications_anonymized.csv"
output: pdf_document

---
<!-- THIS FILE IS NOT SUPPOSED TO BE KNITTED BY HAND
    INSTEAD IT IS KNIT AUTOMATICALLY 
    BY THE APPLICATIONS_REPORT.RMD FILE FOR EACH APPLICANT.
    YOU CAN EDIT THIS FILE IF YOU WANT TO CHANGE THE INFORMATION DISPLAYED FOR EACH APPLICANT
-->
```{r include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(message = FALSE)

library(dplyr)
library(tidyr)
library(tibble)
library(ggplot2)
library(readr)
library(stringr)
library(forcats)

lvls <- tibble(level_num = c(0, 1, 2, 3), level = c("Beginner", "User", "Advanced", "Expert"))
theme_set(theme_bw())
```

```{r message=FALSE}
appl <- readr::read_csv(params$anon_path, col_types = cols())
a <- appl %>% 
  filter(applicant_id == params$applicant_id)
```

```{r}
# data set with all applicants
tmp_all <- appl %>% 
  select(applicant_id, starts_with(c("skills", "techniques", "topics"))) %>% 
  pivot_longer(starts_with(c("skills", "techniques", "topics")), names_to = "category", values_to = "level") %>% 
  mutate(question = stringr::str_extract(category, "skills|techniques|topics")) %>% 
  mutate(category = stringr::str_replace(category, "skills_|techniques_|topics_", "")) %>% 
  rownames_to_column() %>% 
  left_join(lvls, by = "level") %>% 
  mutate(is_applicant_val = applicant_id == params$applicant_id)

tmp_applicant <- tmp_all %>% 
  filter(applicant_id == params$applicant_id)
```

## Applicant `r a$applicant_id` (`r a$project_role`) {#applicant-`r a$applicant_id`}
**Gender**: `r a$gender`

**Project role**: `r a$project_role`

**What skills qualify you?**

`r a$motivation_skills`

**Why do you want to get involved?**

`r a$motivation_why_involved`

### Self-rated experience with skills, techniques and topics 

```{r fig.height=6, fig.width=6}
theme_set(theme_bw())
ggplot(tmp_applicant, aes(x = category, y = level_num, group = question)) +
  geom_segment(aes(
    x = category,
    xend = category,
    y = 0,
    yend = level_num
  )) +
  geom_point(size = 3, color = "#3863a2") +
  coord_flip() +
  theme(
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    legend.position = "none"
  ) +
  scale_y_continuous(
    "level",
    limits = c(0, max(lvls$level_num)),
    breaks = seq(0, max(lvls$level_num), 1),
    labels = lvls$level
  ) +
  facet_wrap( ~ question, nrow = 3, scales = "free_y") +
  xlab("")
```